<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <title>Admin Projets</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/admin.css">
</head>

<body class="matrix-bg">
    <div class="d-flex">
        <!-- Sidebar -->
        <div class="sidebar d-flex flex-column flex-shrink-0 p-3">
            <a href="#" class="mb-3 text-white text-decoration-none text-center">
                <h2 class="fs-4">Admin Panel</h2>
            </a>
            <ul class="nav nav-pills flex-column mb-auto">
                <li class="nav-item">
                    <a href="#" class="nav-link active" id="link-formation" onclick="showSection('formation')">
                        Projets Formation
                    </a>
                </li>
                <li>
                    <a href="#" class="nav-link" id="link-personnel" onclick="showSection('personnel')">
                        Projets Personnels
                    </a>
                </li>
            </ul>
            <div class="mt-auto">
                <button class="btn btn-info w-100" id="exportBtn">ðŸ’¾ Exporter JSON</button>
            </div>
        </div>

        <div class="container-fluid px-5">
            <!-- Section Formation -->
            <div id="section-formation" class="mt-3">
                <h2 class="mb-3">Projets de formation</h2>
                <table id="table-formation" class="table table-dark table-striped">
                    <thead>
                        <tr>
                            <th>Nom</th>
                            <th>URL</th>
                            <th>Description</th>
                            <th>Image</th>
                            <th>Type</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
                <button class="btn btn-info mb-4" onclick="add('formation')">Ajouter</button>
            </div>

            <!-- Section Personnel -->
            <div id="section-personnel" class="mt-3" style="display:none;">
                <h2 class="mb-3">Projets personnels</h2>
                <table id="table-personnel" class="table table-dark table-striped">
                    <thead>
                        <tr>
                            <th>Nom</th>
                            <th>URL</th>
                            <th>Description</th>
                            <th>Image</th>
                            <th>Type</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
                <button class="btn btn-info mb-4" onclick="add('personnel')">Ajouter</button>
            </div>
        </div>
    </div>

    <script>
        let data = { formation: [], personnel: [] };

        // Charger JSON
        fetch('projects.json')
            .then(r => r.json())
            .then(json => { data = json; render(); });

        // Rendu global
        function render() {
            renderTable('formation');
            renderTable('personnel');
        }

        function renderTable(cat) {
            const tbody = document.querySelector(`#table-${cat} tbody`);
            tbody.innerHTML = '';
            data[cat].forEach((p, i) => {
                tbody.innerHTML += `<tr>
            <td><input class="form-control form-control-sm" value="${p.name}" oninput="update('${cat}',${i},'name',this.value)"></td>
            <td><input class="form-control form-control-sm" value="${p.url}" oninput="update('${cat}',${i},'url',this.value)"></td>
            <td><input class="form-control form-control-sm" value="${p.description}" oninput="update('${cat}',${i},'description',this.value)"></td>
            <td><input class="form-control form-control-sm" value="${p.img}" oninput="update('${cat}',${i},'img',this.value)"></td>
            <td><input class="form-control form-control-sm" value="${p.type}" oninput="update('${cat}',${i},'type',this.value)"></td>
            <td><button class="btn btn-sm btn-danger" onclick="remove('${cat}',${i})">ðŸ—‘ supprimer</button></td>
        </tr>`;
            });
        }

        // Gestion des donnÃ©es
        function update(cat, i, field, value) { data[cat][i][field] = value; }
        function remove(cat, i) { data[cat].splice(i, 1); render(); }
        function add(cat) { data[cat].push({ name: '', url: '', description: '', img: '', type: '' }); render(); }

        // Export JSON
        document.getElementById('exportBtn').onclick = () => {
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = 'projects.json';
            a.click();
        };

        // Switch sections avec active
        function showSection(cat) {
            document.getElementById('section-formation').style.display = cat === 'formation' ? 'block' : 'none';
            document.getElementById('section-personnel').style.display = cat === 'personnel' ? 'block' : 'none';

            document.getElementById('link-formation').classList.remove('active');
            document.getElementById('link-personnel').classList.remove('active');
            if (cat === 'formation') document.getElementById('link-formation').classList.add('active');
            if (cat === 'personnel') document.getElementById('link-personnel').classList.add('active');
        }
    </script>
</body>

</html>